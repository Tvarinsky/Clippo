import React, { useEffect, useRef, useState } from 'react';
import PropTypes from 'prop-types';
import videojs from 'video.js';
import 'video.js/dist/video-js.css';
import { useSwipeable } from 'react-swipeable';

const usePlayer = ({ src, controls, autoplay }) => {
  const options = {
    fill: true,
    fluid: true,
    preload: 'auto',
    autoplay: true,
    loop: true,
    html5: {
      hls: {
        enableLowInitialPlaylist: true,
        smoothQualityChange: true,
        overrideNative: true,
      },
    },
  };
  const videoRef = useRef(null);
  const [player, setPlayer] = useState(null);

  useEffect(() => {
    const vjsPlayer = videojs(videoRef.current, {
      ...options,
      controls,
      autoplay,
      sources: [src],
    });
    setPlayer(vjsPlayer);

    return () => {
      if (player !== null) {
        player.dispose();
      }
    };
  }, []);
  useEffect(() => {
    if (player !== null) {
      player.src({ src });
    }
  }, [src]);

  return videoRef;
};

const VideoPlayer = ({ src, controls, autoplay, swipeable  }) => {
  const playerRef = usePlayer({ src, controls, autoplay  });
  const [pausedClippo, setPaused] = useState(false);
  const [volumeMuted, setMute] = useState(true);



  const handlePlayVideo = () => {

    if (pausedClippo) {
      setPaused(false);
      playerRef.current.play();
    } else {
      setPaused(true);
      playerRef.current.pause();
    }
  }

  return (
    <>

    <style jsx>{`
    .iconmuted, .iconpaused, .iconplayed {
      position: absolute;
      top: 40%;
      left: 45%;
      transform: translate(-50%, -50%);
      z-index: 1;
      pointer-events: none;
      opacity: 0;
      transform: scale(0.7);
      transition: .25s;
    }
    .iconmuted svg, .iconpaused svg, .iconplayed svg {
      fill: #fff;
      pointer-events: none;
      max-width: 100px;
      z-index: 1;
      max-height: 100px;
    }
    .clippoBlock {
      max-width: 100vw;
      max-height: 100vw;
      overflow: hidden;
      position: relative;
    }
    .showVolumeAnim {
      animation-duration: 1s;
      animation-name: showVolume;
    }
    .overlay_to {
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
    }
    @keyframes showVolume {
      0% {
        opacity: 0;
        transform: scale(0.7);
      }
      50% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(1);
      }
    }
    
    `}</style>

    <div className="clippoBlock" onClick={() => {
      !volumeMuted && handlePlayVideo();
      setMute(!true);
    }} data-vjs-player>
      <div {...swipeable} className="overlay_to"></div>
      <video id="clippo" ref={playerRef} loop autoPlay playsInline webkit-playsinline="true" muted={volumeMuted ? true : false} className="video-js" />
    </div>

    <div className={!volumeMuted ? 'iconmuted showVolumeAnim' : 'iconmuted'}><svg id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><path d="m496.068 186.263c-9.939-20.932-23.979-39.508-41.732-55.213-8.851-7.828-22.422-6.998-30.252 1.853-7.849 8.873-7.02 22.404 1.853 30.252 27.529 24.352 42.87 57.235 43.194 92.593.326 35.353-14.404 68.511-41.477 93.366-8.724 8.01-9.306 21.556-1.294 30.281 7.934 8.644 21.491 9.364 30.281 1.294 17.458-16.027 31.152-34.858 40.702-55.969 9.941-21.974 14.87-45.312 14.649-69.366-.221-24.055-5.578-47.301-15.924-69.091zm-12.39 132.274c-8.712 19.258-21.221 36.451-37.181 51.102-2.572 2.362-6.641 2.276-9.087-.389-2.403-2.616-2.23-6.683.389-9.087 30.243-27.766 46.697-64.897 46.332-104.554-.365-39.662-17.503-76.486-48.257-103.69-2.656-2.35-2.905-6.422-.556-9.078 2.351-2.658 6.424-2.904 9.079-.557 16.229 14.356 29.055 31.317 38.12 50.412 9.404 19.807 14.275 40.935 14.476 62.794.201 21.861-4.279 43.072-13.315 63.047z"/><path d="m403.185 154.376c-8.836-7.888-22.37-7.125-30.262 1.713-7.87 8.816-7.102 22.391 1.714 30.26 20.72 18.501 32.265 43.35 32.51 69.969.245 26.617-10.84 51.671-31.212 70.549-8.688 8.05-9.207 21.598-1.153 30.286 8.026 8.664 21.588 9.216 30.287 1.154 29.338-27.186 45.298-63.546 44.94-102.383-.358-38.843-16.988-74.907-46.824-101.548zm-8.313 192.929c-2.544 2.359-6.619 2.32-9.088-.347-2.417-2.607-2.262-6.672.346-9.088 23.51-21.785 36.301-50.796 36.017-81.689-.284-30.896-13.609-59.669-37.52-81.02-2.646-2.362-2.876-6.436-.515-9.081 2.364-2.649 6.43-2.882 9.081-.514 26.647 23.792 41.497 55.931 41.815 90.496.319 34.56-13.935 66.964-40.136 91.243z"/><path d="m352.084 177.747c-8.814-7.993-22.347-7.263-30.271 1.476-7.959 8.774-7.299 22.314 1.476 30.274 13.941 12.645 21.71 29.475 21.874 47.392.165 17.914-7.29 34.882-20.993 47.781-8.604 8.1-9.016 21.689-.916 30.295 8.097 8.601 21.657 9.045 30.295.917 22.509-21.187 34.753-49.38 34.477-79.387-.278-30.012-13.042-57.979-35.942-78.748zm-8.817 147.211c-2.629 2.475-6.71 2.256-9.091-.274-2.431-2.583-2.308-6.662.274-9.092 16.784-15.799 25.916-36.696 25.712-58.841-.203-22.148-9.72-42.876-26.797-58.364-2.631-2.387-2.833-6.451-.442-9.086 2.39-2.636 6.458-2.825 9.084-.442 19.765 17.926 30.78 41.996 31.018 67.774.237 25.773-10.332 50.039-29.758 68.325z"/><path d="m269.673 59.68-39.307 22.518c-3.594 2.059-4.839 6.642-2.78 10.236 2.059 3.595 6.642 4.837 10.236 2.78l39.307-22.518c4.373-2.505 9.712.696 9.712 5.628v355.354c0 4.94-5.348 8.13-9.711 5.629l-150.359-86.136v-194.34l80.681-46.22c3.594-2.059 4.839-6.642 2.78-10.236-2.059-3.595-6.643-4.84-10.236-2.78l-82.721 47.389h-86.796c-16.806.001-30.479 13.673-30.479 30.479v157.077c0 16.806 13.673 30.479 30.479 30.479h24.813c4.142 0 7.5-3.358 7.5-7.5s-3.358-7.5-7.5-7.5h-24.813c-8.535 0-15.479-6.944-15.479-15.479v-157.077c0-8.535 6.944-15.479 15.479-15.479h81.292v188.034h-21.479c-4.142 0-7.5 3.358-7.5 7.5s3.358 7.5 7.5 7.5h26.982l152.397 87.303c14.391 8.248 32.169-2.249 32.169-18.644v-355.352c.001-16.352-17.727-26.912-32.167-18.645z"/></g></svg></div>

    <div className={pausedClippo ? 'iconpaused showVolumeAnim' : 'iconpaused'}><svg id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><path d="m510.512 228.242c0-.002 0-.004 0-.006-13.963-129.395-123.593-228.236-254.512-228.236-141.491 0-256 114.497-256 256 0 15.831 1.456 31.684 4.328 47.116.758 4.071 4.673 6.762 8.746 6.001 4.072-.758 6.759-4.673 6.001-8.745-2.704-14.53-4.075-29.459-4.075-44.372 0-132.888 108.112-241 241-241 123.383 0 226.388 92.366 239.598 214.846 0 .002 0 .004.001.006.93 8.622 1.401 17.42 1.401 26.148 0 132.888-108.112 241-241 241-103.501 0-195.28-65.836-228.38-163.824-1.326-3.925-5.582-6.029-9.506-4.705-3.924 1.325-6.031 5.581-4.705 9.506 35.161 104.088 132.651 174.023 242.591 174.023 141.491 0 256-114.497 256-256 0-9.264-.5-18.603-1.488-27.758z"/><path d="m223.578 384.478c7.995 0 14.5-6.505 14.5-14.5v-227.956c0-7.995-6.505-14.5-14.5-14.5h-49.25c-7.995 0-14.5 6.505-14.5 14.5v227.955c0 7.995 6.505 14.5 14.5 14.5h49.25zm-48.75-241.956h48.25v226.955h-48.25z"/><path d="m344.672 176.068c4.142 0 7.5-3.357 7.5-7.5v-26.546c0-7.995-6.505-14.5-14.5-14.5h-49.25c-7.995 0-14.5 6.505-14.5 14.5v227.955c0 7.995 6.505 14.5 14.5 14.5h49.25c7.995 0 14.5-6.505 14.5-14.5v-166.409c0-4.143-3.358-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v165.909h-48.25v-226.955h48.25v26.046c0 4.143 3.358 7.5 7.5 7.5z"/></g></svg></div>

    <div className={!pausedClippo ? 'iconplayed showVolumeAnim' : 'iconplayed'}><svg id="Capa_1" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><path d="m510.512 228.242c0-.002 0-.004 0-.006-13.963-129.395-123.593-228.236-254.512-228.236-141.491 0-256 114.497-256 256 0 15.831 1.456 31.684 4.328 47.116.758 4.071 4.671 6.762 8.746 6.001 4.072-.758 6.759-4.673 6.001-8.745-2.704-14.53-4.075-29.459-4.075-44.372 0-132.888 108.112-241 241-241 123.383 0 226.388 92.366 239.598 214.846 0 .002 0 .004.001.006.93 8.622 1.401 17.42 1.401 26.148 0 132.888-108.112 241-241 241-103.501 0-195.28-65.836-228.38-163.824-1.325-3.925-5.582-6.029-9.506-4.705-3.924 1.325-6.031 5.581-4.705 9.506 35.161 104.088 132.651 174.023 242.591 174.023 141.491 0 256-114.497 256-256 0-9.264-.5-18.603-1.488-27.758z"/><path d="m181.819 130.669c3.241 0 6.366.844 9.29 2.509l21.094 12.011c3.6 2.051 8.179.793 10.229-2.807 2.049-3.6.793-8.179-2.807-10.229l-21.094-12.011c-5.14-2.927-10.919-4.474-16.712-4.474-18.685 0-33.887 15.203-33.887 33.89v214.702c0 18.687 15.202 33.89 33.887 33.89 5.795 0 11.574-1.547 16.712-4.474l188.545-107.351c10.709-6.097 17.102-17.094 17.102-29.418 0-12.323-6.394-23.32-17.102-29.415l-137.036-78.022c-3.6-2.049-8.178-.793-10.229 2.807-2.049 3.6-.793 8.179 2.807 10.229l137.037 78.022c5.962 3.395 9.522 9.518 9.522 16.38 0 6.863-3.56 12.987-9.523 16.383l-188.546 107.352c-2.922 1.664-6.047 2.508-9.289 2.508-9.083 0-18.887-7.222-18.887-18.89v-214.702c.001-11.668 9.804-18.89 18.887-18.89z"/></g></svg></div>

    </>
  );
};

export default VideoPlayer;